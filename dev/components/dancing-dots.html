<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<template>
  <style>
    dancing-dots bullet {
      display: inline-block;
      font-size: 2em;
    }
    dancing-dots bullet::after {
      content: 'â€¢'
    }
    body dancing-dots[off] bullet {
      color: silver;
    }
    dancing-dots bullet:nth-of-type(1) {
      color: blue;
    }
    dancing-dots bullet:nth-of-type(2) {
      color: red;
    }
    dancing-dots bullet:nth-of-type(3) {
      color: orange;
    }
    dancing-dots bullet:nth-of-type(4) {
      color: green;
    }
  </style>
  <div bullets>
    <bullet one></bullet>
    <bullet two></bullet>
    <bullet three></bullet>
    <bullet four></bullet>
  </div>
</template>

<script>
  class DancingDots extends HTMLElement {
    connectedCallback() {
      if (!this.childElementCount) {
        this.appendChild(this.constructor.module.querySelector('template').content.cloneNode(true));
      }
    }
    get disabled() {
      return this._disabled;
    }
    set disabled(disabled) {
      this._disabled = disabled;
      if (this._disabled) {
        this.active = false;
        this.setAttribute('off', '');
      } else {
        this.removeAttribute('off');
      }
    }
    get active() {
      return this._active;
    }
    set active(active) {
      this._active = active;
      this._active ? this._start() : this._stop();
    }
    _start() {
      this.querySelectorAll('bullet').forEach((bullet, i) => {
        let keyframes = {transform: ['translateY(8px)', 'translateY(-8px)']};
        let timing = {
          iterations: Infinity,
          duration: 200,
          direction: 'alternate',
          iterationStart: 0.5,
          easing: 'ease-in-out',
          delay: i * 40,
        };
        bullet._animation = bullet.animate(keyframes, timing);
      });
    }
    _stop() {
      for (let bullet of this.querySelectorAll('bullet')) {
        // Ideally we would cause the animation to reach the half way point
        // between iterations, but that's complicated without the setTiming
        // API.
        let transform = getComputedStyle(bullet).transform;
        let animation = bullet._animation;
        let stopAnimation = bullet.animate(
            {transform: [transform, 'translateY(0px)']},
            {duration: 166.66, easing: 'ease'});
        stopAnimation.startTime = animation.startTime + animation.currentTime;
        animation.cancel();
      }
    }
    startStop() {
      this.active = !this.active;
    }
    disEnable() {
      this.disabled = !this.disabled;
    }
  }
  DancingDots.module = document.currentScript.ownerDocument;
  customElements.define('dancing-dots', DancingDots);
</script>