<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<style>
  data-item {
    display: block;
    min-height: 28px;
  }
  data-item > * {
    overflow: hidden;
    text-overflow: ellipsis;
    white-space: nowrap;
    display: inline-block;
    vertical-align: middle;
  }
  data-item > left {
    vertical-align: top;
    padding: 4px;
    color: gray;
  }
  data-item > left::before {
    content: 'â‹… '
  }
  data-item > right > span {
    display: inline-block;
    padding: 4px;
  }
  data-item > right > data-explorer {
    margin: 4px 16px;
  }
  data-item > right > [expander] {
    font-size: 0.6em;
    background: whitesmoke;
    border: 1px solid silver;
    padding: 0 2px;
    cursor: pointer;
  }
</style>

<template>
  <left title="{{name}}" on-click="_onExpandClick"><span>{{name}}</span>: </left>
  <right>
    <span expander hidden="{{hideexpand}}" on-click="_onExpandClick">+</span>
    <span hidden="{{notbool}}" title="{{name}}"><input type="checkbox" checked="{{value}}" on-click="_onCheckInput"></span>
    <span hidden="{{notstring}}" title="{{title}}">{{value}}</span>
    <data-explorer hidden="{{notobject}}" object="{{object}}"></data-explorer>
  </right>
</template>

<script>
  class DataItem extends XenBase {
    static get observedAttributes() { return ['name','value']; }
    get host() {
      return this;
    }
    _onCheckInput(e) {
      e.stopPropagation();
      this.dispatchEvent(new CustomEvent('item-change', {detail: e.target.checked}));
    }
    _render(props, state) {
      let type = typeof props.value;
      let isobject = (type === 'object'), isstring = (type === 'string'), isbool = (type==='boolean');
      if (!isNaN(Number(props.name))) {
        state.expanded = true;
      }
      return {
        name: props.name,
        notstring: !isstring,
        notbool: !isbool,
        notobject: !isobject || !state.expanded,
        object: isobject && state.expanded ? props.value : null,
        hideexpand: state.expanded || !isobject,
        value: /*isstring ? props.value.slice(-54) :*/ props.value,
        title: isstring ? props.value : props.name
      };
    }
    _onExpandClick(e) {
      e.stopPropagation();
      this._setState({expanded: !this._state.expanded});
    }
  }
  DataItem.module = document.currentImport;;
  window.customElements.define('data-item', DataItem);
</script>
