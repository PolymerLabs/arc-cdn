<!--
@license
Copyright (c) 2016 The Polymer Project Authors. All rights reserved.
This code may only be used under the BSD style license found at http://polymer.github.io/LICENSE.txt
The complete set of authors may be found at http://polymer.github.io/AUTHORS.txt
The complete set of contributors may be found at http://polymer.github.io/CONTRIBUTORS.txt
Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->

<!-- component dependencies -->
<link rel="import" href="../../components/xen/xen.html">
<link rel="import" href="arc-config.html">
<link rel="import" href="arc-shell.html">
<link rel="import" href="arc-view.html">

<template>
  <style>
    :host {
      display: block;
    }
    i {
      font-family: 'Material Icons';
      font-size: 24px;
      font-style: normal;
      -webkit-font-feature-settings: 'liga';
      -webkit-font-smoothing: antialiased;
      vertical-align: middle;
    }
    toolbar {
      display: block;
      height: 40px;
    }
    app-toolbar {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      height: 40px;
      display: flex;
      align-items: center;
      white-space: nowrap;
      padding: 0 8px;
      box-sizing: border-box;
      background-color: whitesmoke;
      z-index: 1000;
      transform: translate(0,0,0); /* makes it a layer so other layers scroll underneath, is there a better way? */
    }
    app-toolbar > * {
      padding: 0 4px;
    }
  </style>

  <toolbar>
    <app-toolbar>
      <i style="color: gray;" on-click="_onNavClick">donut_large</i>
      <span arc-title style="flex: 1; min-height: 0.6em; padding-top: 0.1em;" style%={{titleStatic}} on-click="_onStartEditingTitle" unsafe-html="{{title}}"></span>
      <!--<select on-change="_onUserSelected">{{usersOptions}}</select>-->
      <i on-click="_onProfileClick">{{profileStateIcon}}</i>
      <i on-click="_onShareClick">{{sharedStateIcon}}</i>
      <i on-click="_onCastClick">{{castIcon}}</i>
    </app-toolbar>
  </toolbar>

  <simple-tabs>
    <div title="Launcher">
      <arc-config shellpath="{{shellpath}}" on-config="_onLauncherConfig"></arc-config>
      <arc-view arc="{{launcherArc}}" data="{{arcsViewData}}" options="{{arcsViewOptions}}" on-view="_onArcsView"></arc-view>
      <arc-shell user="{{user}}" config="{{launcherConfig}}" ready="{{launcherReady}}" on-arc="_onLauncherArc">
        <div slotid="toproot"></div>
        <div slotid="root"></div>
      </arc-shell>
    </div>
    <div title="Arc">
      <arc-config shellpath="{{shellpath}}" on-config="_onGeneralConfig"></arc-config>
      <arc-shell user="{{user}}" config="{{generalConfig}}" ready="{{generalReady}}" on-arc="_onGeneralArc">
        <div slotid="toproot"></div>
        <div slotid="root"></div>
      </arc-shell>
    </div>
  </simple-tabs>

</template>

<script>
  class ArcApp extends XenBase {
    _getInitialState() {
      let shellpath = ArcApp.module.URL.split('/').slice(0, -3).join('/');
      return {
        shellpath,
        icons: {
          profileStateIcon: `person_outline`,
          sharedStateIcon: `link`,
          castIcon: `cast`
        },
        user: 'Scott',
        arcsViewOptions: {
          manifestPath: `${shellpath}/app-shell.2/artifacts/arc-types.manifest`,
          typeName: 'ArcMetadata',
          name: 'ArcMetadata',
          tags: ['#arcmetadata','#nosync']
        },
        arcsViewData: this._synthesizeArcsViewData()
      }
    }
    _didMount() {
      this._invalidate();
    }
    _onLauncherConfig(e, config) {
      config.soloPath = 'launcher.manifest';
      this._setState({launcherConfig: config});
    }
    async _onLauncherArc(e, arc) {
      this._setState({launcherArc: arc});
    }
    _onArcsView(e, view) {
      ArcApp.log('ArcsView', view);
      this._setState({launcherReady: true});
    }
    _onGeneralConfig(e, config) {
      this._setState({generalConfig: config});
    }
    _onGeneralArc(e, arc) {
      this._setState({generalReady: true});
    }
    _render(props, state) {
      let {icons} = state;
      return [icons, state, {
        title: 'Sample Arc'
      }];
    }
    _synthesizeArcsViewData() {
      let icons= ['settings','movie','new_releases','high_quality','room_service','casino','child_care','spa','kitchen'];
      let colors = ['darkred','darkblue','darkgreen','darkorange','black'];
      let arcs = {
        a: {description: 'Alpha'},
        b: {description: 'Beta'},
        c: {description: 'Gamma'},
        d: {description: 'Delta'},
        e: {description: 'Epsilon'}
      };
      arcs = Object.keys(arcs).map(k => {
        let description = arcs[k].description;
        return {
          key: k,
          description: description,
          icon: icons[Math.floor(Math.random()*icons.length)],
          color: colors[Math.floor(Math.random()*colors.length)],
          href: `javascript:void(0)` //${location.origin}${location.pathname}?amkey=${k}`
        };
      });
      return arcs;
    }
  }
  ArcApp.module = document.currentImport;
  ArcApp.pre = [`%cArcHost`, `background: #673AB7; color: white; padding: 1px 6px 2px 7px; border-radius: 6px;`];
  ArcApp.log = console.log.bind(console, ...ArcApp.pre);
  customElements.define('arc-app', ArcApp);
</script>